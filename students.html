<!DOCTYPE html>
<html>
<head>
  <title>Student Management</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<h2>Student Management</h2>

<h3>Add / Edit Student</h3>

<input type="text" id="studentId" placeholder="Student ID"><br><br>
<input type="text" id="studentName" placeholder="Student Name"><br><br>
<input type="text" id="studentClass" placeholder="Class / Department"><br><br>

<button onclick="startFaceCapture()">Capture Face</button>
<button onclick="saveStudent()">Save Student</button>

<hr>

<h3>Existing Students</h3>

<table border="1">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Class</th>
    </tr>
  </thead>
  <tbody id="studentTable"></tbody>
</table>

<!-- âœ… SINGLE MODULE SCRIPT -->
<script type="module">

  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDocs, collection } 
    from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // ðŸ”¥ Firebase config (yours)
  const firebaseConfig = {
    apiKey: "AIzaSyCM8kgEho_Z32ryhNxCjIF7W1PDi284cR8",
    authDomain: "attendance-system-f89d2.firebaseapp.com",
    projectId: "attendance-system-f89d2",
    storageBucket: "attendance-system-f89d2.firebasestorage.app",
    messagingSenderId: "684026196262",
    appId: "1:684026196262:web:09bb0db46bb85c14d811e7"
  };

  // ðŸ”¥ Init Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // âœ… SAVE STUDENT
  window.saveStudent = async function () {
    const id = studentId.value;
    if (!id) {
      alert("Enter Student ID");
      return;
    }

    await setDoc(doc(db, "students", id), {
      name: studentName.value,
      class: studentClass.value,
      faceRegistered: false
    });

    alert("Student saved in Firebase");
    loadStudents();
  };

  // âœ… CAPTURE FACE
  window.startFaceCapture = async function () {
    const id = studentId.value;
    if (!id) {
      alert("Enter Student ID first");
      return;
    }

  // redirect to admin QR generator
  window.location.href =
    "admin/index.html?mode=register&studentId=" + encodeURIComponent(id);
};

  

  // âœ… LOAD STUDENTS
  async function loadStudents() {
    const table = document.getElementById("studentTable");
    table.innerHTML = "";

    const querySnapshot = await getDocs(collection(db, "students"));
    querySnapshot.forEach(docSnap => {
      const s = docSnap.data();
      table.innerHTML += `
        <tr>
          <td>${docSnap.id}</td>
          <td>${s.name}</td>
          <td>${s.class}</td>
        </tr>
      `;
    });
  }

  loadStudents();

</script>

</body>
</html>
